---
title: "Manage Your Slack Teams"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Manage Teams}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Here are the ways you can use `slackteams` to manage your slack teams.

These methods are designed to store and load the information needed to interact with the Slack API.

## Visual Workflow

```{r,out.width='100%',echo=FALSE}
knitr::include_graphics('../man/figures/diag.png')
```


## Terminology and Prerequisites

Environment Variable| Description | Creator
:--|:--|:--:
SLACK_CHANNEL| Default Channel to Post | User 
SLACK_USERNAME| Slack User Name | User 
SLACK_API_TOKEN| Slack API token | Slack*
SLACK_INCOMING_URL_PREFIX| Slack incoming webhook URL | Slack 

\* The API token and incoming webhook are values generated by Slack. 

  - For new users you can use the button in the main [README](https://github.com/yonicd/slackteams) page of this repository or directly at the [slackr-app](https://github.com/yonicd/slackr-app) application homepage to create these two elements. 

  - Users of [slackr](https://github.com/hrbrmstr/slackr) most likely are familiar with these and know how to create them. 

## Methods

There are two main methods to set up credentials with the Slack API, each has their own pros and cons depending on what type of usage you may have

Management Type|Manage Multiple Teams in Session|Store Credentials Locally|Depend on External Server
:--:|:--:|:--:|:--:
JSON | Yes | No | Yes
DCF  | No | Yes | No 

## JSON

The primary method that `slackteams` loads and activates teams into the session is via a local JSON file. The contents of this file can contain multiple teams which you can activate during a session.

### Loading A Team

If you are using the `slackr-app` then for every team that you create a `SLACK_API_TOKEN` and `SLACK_INCOMING_URL_PREFIX` pairing you will receive from `slackr-app` server two pieces of information to store in the JSON. The assumed location of the JSON is `~/.slackteams`.

  1. key: unique identifier to your record on the server
  2. memberid: your slack team member id which is used to verify that you sent the key.

In other words the key is not very useful for other people if they do not have the member id to identify themselves.

Here is an example of what the JSON looks like

```json
{
  "slackr": {
    "key": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
    "memberid": "UABC123"
  },
  "r4ds": {
    "key": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
    "memberid": "UXYZ456"
  }
}
```

For a given `TEAM` you then can use `slackteams::activate_team(TEAM)`. This function sends to the `slackr-app` server the pairing information and the server will return back the values for the environment variables that are set in the session.

### Adding A Team Within Session

If you have a JSON file already created and want to add a team that you generated credentials via the `slackr-app` via the console you can use `slackteams::add_team` to manually update the slackteams environment with the new team.

```r
slackteams::add_team(MY_NEW_TEAM,memberid,key)
```

If you want to store this information in your JSON file you can use, which will either update (teams that exists) or append (new teams) to the local JSON.

```r
slackteams::update_team_file(PATH_TO_JSON)
```

## DCF

### Loading A Team

A different session persistent method to set the correct environment variables is via `slackteams::load_team_dcf(team = TEAM,file = PATH_TO_DCF)`. This function expects a name for the team that you are loading and the path to the DCF file containing the following information:

Variable| Description
:--|:--
channel| Default Channel to Post
username| Slack User Name
api_token| Slack API token
incoming_webhook_url| Slack incoming webhook URL

These correspond to the environment variables in the first table. These are also the exact fields that [slackr](https://github.com/hrbrmstr/slackr) uses, which makes it easy to either migrate to `slackteams` or use `slackteams` to use `slackr`.

### Converting JSON to DCF

For convenience after you activate a team you can convert the credentials of the active team to a local DCF file using `slackteams::activeteam2dcf()`. 

  - This can be useful if you know that you activate one team most of the time and want to manage your own credentials. 

  - It is also useful if you have unit testing that is dependent on Slack, in which case depending on an external server is over-burdensome.
